<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../vaadin-date-picker/vaadin-date-picker-light.html">
<link rel="import" href="../d2l-colors/d2l-colors.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../d2l-time-picker/d2l-time-picker.html">
<link rel="import" href="../d2l-intl/d2l-intl.html">

<!--
`d2l-date-picker`
A Date Picker for D2L Brightspace

@demo demo/index.html
-->

<dom-module id="d2l-date-picker">
	<template>
		<custom-style>
			<style is="custom-style" include="d2l-input-styles">
				:host {
					display: block;
				}

				vaadin-date-picker-light {
					--primary-color: var(--d2l-color-celestine);
					--light-primary-color: var(--d2l-color-celestine-plus-1);
					--dark-theme-background-color: var(--d2l-color-ferrite);
					--dark-theme-secondary-color: var(--d2l-color-white);
					--primary-text-color: var(--d2l-color-ferrite);
					--secondary-text-color: var(--d2l-color-tungsten);

					--vaadin-date-picker-overlay: {
						font-family: inherit;
						max-height: 305px;
					};
					--vaadin-date-picker-yearscroller: {
						font-family: inherit;
					};
					--vaadin-date-picker-header: {
						font-family: inherit;
					};
					--vaadin-date-picker-calendar-title: {
						font-family: inherit;
					};
					--vaadin-date-picker-calendar-cell: {
						font-family: inherit;
					};
					--vaadin-date-picker-footer: {
						font-family: inherit;
					};
					--vaadin-date-picker-calendar: {
						font-family: inherit;
					};
				};
			</style>
		</custom-style>

		<label for="input">{{label}}</label>
		<vaadin-date-picker-light min="[[min]]" max="[[max]]" value="{{value}}" on-value-changed="handleValueChanged">
			<iron-input>
				<input id="input" aria-label$="{{label}}" placeholder="{{placeholder}}" class="d2l-input" is="iron-input" type="text" on-focus="_handleFocus"/>
			</iron-input>
		</vaadin-date-picker-light>
		<script>
			window.addEventListener("WebComponentsReady", function() {
				var locale = d2lIntl.LocaleProvider("[[locale]]");

				var merge = function(obj1, obj2) {
					if (obj2 === undefined || obj2 === null || typeof(obj2) !== 'object') {
						return
					}
					for (var i in obj2) {
						if (obj1.hasOwnProperty(i)) {
							if (typeof(obj2[i]) === 'object' && typeof(obj1[i]) === 'object' ) {
								merge(obj1[i], obj2[i]);
							} else {
								obj1[i] = obj2[i];
							}
						}
					}
				}

				var datePicker = document.querySelector('vaadin-date-picker-light');
				localeOverrides = {
					monthNames: locale.date.calendar.months.long,
					weekdays: locale.date.calendar.days.long,
					weekdaysShort: locale.date.calendar.days.short,
					firstDayOfWeek: locale.date.calendar.firstDayOfWeek
					// today: 'Tänään', TODO: add in when we have translations
					// cancel: 'Peruuta',
				}
				merge(datePicker.i18n, localeOverrides);
			});
		</script>
	</template>

	<script>
		Polymer({

			is: 'd2l-date-picker',

			attached: function() {
				var buttons = document.getElementsByClassName('vaadin-date-picker-overlay paper-button-0');
				for (var i = 0; i < buttons.length; i++) {
					buttons[i].style.fontFamily = 'inherit';
				}
			},

			properties: {
				placeholder: {
					type: String
				},
				min: {
					type: String
				},
				max: {
					type: String
				},
				value: {
					type: String,
					reflectToAttribute: true
				},
				label: {
					type: String
				},
				locale: {
					type: String,
					default: 'en'
				}
			},

			handleValueChanged: function(e, detail) {
				this.value = detail.value;
				this.fire('d2l-date-picker-value-changed', e, detail);
			},

			focus: function() {
				this.$$('input').focus();
			},

			_handleFocus: function() {
				// in shady DOM the input's "focus" event does not bubble,
				// so no need to fire it
				if (!Polymer.Settings.useShadow) {
					this.dispatchEvent( new CustomEvent(
							'focus',
							{bubbles: true, composed: false}
						) );
				}
			}

		});
	</script>
</dom-module>
